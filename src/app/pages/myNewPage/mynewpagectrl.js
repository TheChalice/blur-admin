/** * Created by sorcerer on 2017/3/9. *//** * @author v.lugovsky * created on 16.12.2015 */(function () {    'use strict';    angular.module('BlurAdmin.pages.myNewPage')        .controller('MyNewPageCtrl', MyNewPageCtrl);    /** @ngInject */    function MyNewPageCtrl($q, $scope, $http, $base64, Cookie, User, $rootScope, Project, $log,$state) {        //User.get({}, function (data) {        //        //})        $scope.credentials = {};        $scope.login = function () {            console.log('$scope.credentials', $scope.credentials);            var deferred = $q.defer();            var req = {                method: 'GET',                timeout: deferred.promise,                url: '/signin',                headers: {                    //'Authorization': 'Basic ' + $scope.credentials.username + ':' + $scope.credentials.password                    'Authorization': 'Basic ' + $base64.encode($scope.credentials.username + ':' + $scope.credentials.password)                }            };            $http(req).success(function (data) {                //console.log('success', data);                if (data.length) {                    $rootScope.region = "cn-north-1";                    angular.forEach(data, function (token, i) {                        //arr.push(token.region)                        if (token.region && token.region === "cn-north-1") {                            Cookie.set('df_access_token', token.access_token, 10 * 365 * 24 * 3600 * 1000);                            Cookie.set('region', "cn-north-1", 10 * 365 * 24 * 3600 * 1000);                        }                    })                }                User.get({name: '~'}, function (user) {                    console.log('success', user);                    $rootScope.user = user;                    $rootScope.namespace = user.metadata.name;                    Project.get({}, function (Project) {                        console.log("load project success", data);                        $rootScope.projects = Project.items;                        $state.go('dashboard');                        //$log.info("can't find project");                    }, function (res) {                        $log.info("find project err", res);                    })                })                //            }).error(function (data) {                console.log('error', data);            });        }        //test.get({}, function (data) {        //        //})    }})();