/** * Created by sorcerer on 2017/11/1. */(function () {    'use strict';    angular.module('BlurAdmin.pages.servicedetil')        .controller('serviceDetilEventCtrl', serviceDetilEventCtrl);    /** @ngInject */    function serviceDetilEventCtrl($scope,Event,Ws,$rootScope) {        function loadeventws() {            Event.get({namespace: $rootScope.namespace}, function (res) {                if (!$scope.eventsws) {                    $scope.eventsws = []                    var arr = []                    angular.forEach(res.items, function (event, i) {                        if (event.involvedObject.kind !== 'BackingServiceInstance') {                            if ($scope.dc && event.involvedObject.name.split('-')[0] == $scope.dc.metadata.name && event.involvedObject.name.split('-')[2] != 'build') {                                arr.push(event)}                        }                    })                    $scope.hasevent==arr.length                    angular.forEach(arr, function (item, i) {                        arr[i].mysort = -(new Date(item.metadata.creationTimestamp)).getTime()                    })                    arr.sort(function (x, y) {                        return x.mysort > y.mysort ? -1 : 1;                    });                    $scope.eventsws.items = arr;                    //console.log('$scope.eventsws.items', $scope.eventsws.items);                }                watchevent(res.metadata.resourceVersion);            }, function (res) {            });        };        loadeventws()        function watchevent(resourceVersion) {            Ws.watch({                api: 'k8s',                resourceVersion: resourceVersion,                namespace: $rootScope.namespace,                type: 'events',                name: ''                //app:$scope.grid.labelSelector            }, function (res) {                var data = JSON.parse(res.data);                updateEvent(data);            }, function () {            }, function () {            });        }        function updateEvent(data) {            if (data.type == "ADDED") {                if (data.object.involvedObject.name.split('-')[0] == $scope.dc.metadata.name) {                    data.object.mysort = -(new Date(data.object.metadata.creationTimestamp)).getTime()                    $scope.eventsws.items.push(data.object);                    $scope.$apply()                }            } else if (data.type == "MODIFIED") {                if ($scope.dc && data.object.involvedObject.name.split('-')[0] == $scope.dc.metadata.name) {                    data.object.mysort = -(new Date(data.object.metadata.creationTimestamp)).getTime()                    $scope.eventsws.items.push(data.object);                    $scope.$apply()                }            }        }    }})();