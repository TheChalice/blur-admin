/** * Created by sorcerer on 2017/11/1. */(function () {    'use strict';    angular.module('BlurAdmin.pages.servicedetil')        .controller('serviceDetilTopCtrl', serviceDetilTopCtrl);    /** @ngInject */    function serviceDetilTopCtrl($scope,$state,DeploymentConfig,$rootScope,ReplicationController,deletepod,Service,Route) {        function rmRcs(dc) {            if (!dc) {                return;            }            var labelSelector = 'openshift.io/deployment-config.name=' + dc;            ReplicationController.remove({                namespace: $rootScope.namespace,                labelSelector: labelSelector,                region:$rootScope.region            }, function (res) {                // $log.info("remove rcs success", res);                rmDc(dc)            }, function (res) {                // $log.info("remove rcs err", res);            });        };        function rmDc(dc) {            if (!dc) {                return;            }            DeploymentConfig.remove({                namespace: $rootScope.namespace,                name: dc,                region:$rootScope.region            }, function () {                deletepod.delete({                    namespace: $rootScope.namespace,                    region:$rootScope.region,                    name: $scope.dc.metadata.name                }, function (data) {                    //console.log('dele', data);                },function(err){                })                $state.go("applications.deploymentConfig");            }, function (res) {                // $log.info("remove deploymentConfig fail", res);                //todo 错误处理            });        };        var deleService = function () {            Service.delete({namespace: $rootScope.namespace, name: $scope.dc.metadata.name}, function (res) {                // console.log("deleService-yes",res);            }, function (res) {                // console.log("deleService-no",res);            })        }        var deleRoute = function () {            Route.delete({namespace: $rootScope.namespace, name: $scope.dc.metadata.name}, function (res) {                // console.log("deleRoute-yes",res);            }, function (res) {                // console.log("deleRoute-no",res);            })        }        $scope.deletedc = function () {            if ($scope.rcs&&$scope.rcs.items && $scope.rcs.items.length > 0) {                rmRcs($scope.dc.metadata.name);            } else {                rmDc($scope.dc.metadata.name);            }            deleService();            deleRoute();        };        $scope.change = function () {            DeploymentConfig.get({namespace: $rootScope.namespace,name:$scope.dc.metadata.name}, function (data) {                if ($scope.status.text === '启动') {                    if (data.metadata.annotations['dadafoundry.io/last-replicas']) {                        if (data.metadata.annotations['dadafoundry.io/last-replicas'] - 0 > 0) {                            data.spec.replicas=data.metadata.annotations['dadafoundry.io/last-replicas']                        }else {                            data.spec.replicas=1;                        }                    }else {                        data.spec.replicas=1;                    }                }else {                    data.metadata.annotations['dadafoundry.io/last-replicas']=data.spec.replicas.toString();                    data.spec.replicas=0;                }                DeploymentConfig.put({namespace: $rootScope.namespace,name:$scope.dc.metadata.name}                    ,data, function (data) {                    })            })        };    }})();